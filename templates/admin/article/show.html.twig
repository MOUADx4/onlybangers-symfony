{% extends 'base.html.twig' %}

{% block title %}{{ article.title }} - OnlyBangers{% endblock %}

{% block body %}
<article class="mb-5">

    <h1 class="mb-2">{{ article.title }}</h1>

    <p class="text-muted">
        Post√© par <strong>{{ article.author.username }}</strong>
        le {{ article.createdAt|date('d/m/Y H:i') }}
    </p>
    <a href="{{ path('article_favorite', {id: article.id}) }}"
        class="fs-3 text-decoration-none"
        style="cursor:pointer;">
        {% if app.user and article in app.user.favorites %}
            <span style="color:red;">‚ù§Ô∏è</span>
        {% else %}
            <span style="color:grey;">ü§ç</span>
        {% endif %}
    </a>

    <hr>
    {% if article.image %}


    <img 
        src="{{ asset('uploads/articles/' ~ article.image) }}" 
        alt="{{ article.title }}" 
        class="img-fluid rounded mb-4"
        style="max-height: 400px; object-fit: cover; width: 100%;"
    >
{% endif %}

    <div class="mb-4">
        {{ article.content|nl2br }}
    </div>

    <h4 class="mt-5">Commentaires</h4>

    {% if latestComments is empty %}
        <p class="text-muted">Aucun commentaire pour le moment.</p>
    {% else %}
        {% for comment in latestComments %}
            <div class="border rounded p-3 mb-3">
                <div class="fw-bold">
                    {{ comment.author.username }}
                    <span class="text-muted fw-normal ms-2">
                        {{ comment.createdAt|date('d/m/Y H:i') }}
                    </span>
                </div>

                <div class="mt-1">
                    {{ comment.content|nl2br }}
                </div>
            </div>
        {% endfor %}
    {% endif %}

    {% if app.user %}
        <h4 class="mt-4">Ajouter un commentaire</h4>

        {{ form_start(comment_form) }}
            {{ form_errors(comment_form) }}
            {{ form_row(comment_form.content) }}
            <button class="btn btn-secondary mt-2">
                Envoyer
            </button>
        {{ form_end(comment_form) }}
    {% else %}
        <p class="text-muted mt-4">
            Vous devez √™tre connect√© pour poster un commentaire.
        </p>
        <a href="{{ path('app_login') }}" class="btn btn-primary">
            Se connecter
        </a>
    {% endif %}

    <a href="{{ path('article_list') }}" class="btn btn-link mt-4">
        ‚Üê Retour √† la liste des articles
    </a>

</article>
{% endblock %}
